<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>3 Scattered foundations | Interactive web-based data visualization with R, plotly, and shiny</title>
  <meta name="description" content="A useR guide to creating highly interactive graphics for exploratory and expository visualization.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="3 Scattered foundations | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A useR guide to creating highly interactive graphics for exploratory and expository visualization." />
  <meta name="github-repo" content="ropensci/plotly" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Scattered foundations | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta name="twitter:site" content="@cpsievert" />
  <meta name="twitter:description" content="A useR guide to creating highly interactive graphics for exploratory and expository visualization." />
  

<meta name="author" content="Carson Sievert">


<meta name="date" content="2019-04-04">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="overview.html">
<link rel="next" href="maps.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize/selectize.min.js"></script>
<link href="libs/colourpicker/colourpicker.min.css" rel="stylesheet" />
<script src="libs/colourpicker/colourpicker.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/plotly.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/summary-fix.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#why-interactive-web-graphics-from-r"><i class="fa fa-check"></i><b>1.1</b> Why interactive web graphics <em>from R</em>?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.2</b> What you will learn</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-you-wont-learn-much-of"><i class="fa fa-check"></i><b>1.3</b> What you wonâ€™t learn (much of)</a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#web-technologies"><i class="fa fa-check"></i><b>1.3.1</b> Web technologies</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#d3js"><i class="fa fa-check"></i><b>1.3.2</b> d3js</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#ggplot2"><i class="fa fa-check"></i><b>1.3.3</b> ggplot2</a></li>
<li class="chapter" data-level="1.3.4" data-path="introduction.html"><a href="introduction.html#graphical-data-analysis"><i class="fa fa-check"></i><b>1.3.4</b> Graphical data analysis</a></li>
<li class="chapter" data-level="1.3.5" data-path="introduction.html"><a href="introduction.html#data-visualization-best-practices"><i class="fa fa-check"></i><b>1.3.5</b> Data visualization best practices</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#run-code-examples"><i class="fa fa-check"></i><b>1.5</b> Run code examples</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#getting-help-and-learning-more"><i class="fa fa-check"></i><b>1.6</b> Getting help and learning more</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.8</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Creating views</b></span></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a><ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#intro-plotly"><i class="fa fa-check"></i><b>2.1</b> Intro to <code>plot_ly()</code></a></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#intro-plotly-js"><i class="fa fa-check"></i><b>2.2</b> Intro to plotly.js</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#intro-ggplotly"><i class="fa fa-check"></i><b>2.3</b> Intro to <code>ggplotly()</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scatter-traces.html"><a href="scatter-traces.html"><i class="fa fa-check"></i><b>3</b> Scattered foundations</a><ul>
<li class="chapter" data-level="3.1" data-path="scatter-traces.html"><a href="scatter-traces.html#markers"><i class="fa fa-check"></i><b>3.1</b> Markers</a><ul>
<li class="chapter" data-level="3.1.1" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-alpha"><i class="fa fa-check"></i><b>3.1.1</b> Alpha blending</a></li>
<li class="chapter" data-level="3.1.2" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-color"><i class="fa fa-check"></i><b>3.1.2</b> Colors</a></li>
<li class="chapter" data-level="3.1.3" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-symbol"><i class="fa fa-check"></i><b>3.1.3</b> Symbols</a></li>
<li class="chapter" data-level="3.1.4" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-stroke"><i class="fa fa-check"></i><b>3.1.4</b> Stroke and span</a></li>
<li class="chapter" data-level="3.1.5" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-size"><i class="fa fa-check"></i><b>3.1.5</b> Size</a></li>
<li class="chapter" data-level="3.1.6" data-path="scatter-traces.html"><a href="scatter-traces.html#dot-plots"><i class="fa fa-check"></i><b>3.1.6</b> Dotplots &amp; error bars</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="scatter-traces.html"><a href="scatter-traces.html#lines"><i class="fa fa-check"></i><b>3.2</b> Lines</a><ul>
<li class="chapter" data-level="3.2.1" data-path="scatter-traces.html"><a href="scatter-traces.html#linetypes"><i class="fa fa-check"></i><b>3.2.1</b> Linetypes</a></li>
<li class="chapter" data-level="3.2.2" data-path="scatter-traces.html"><a href="scatter-traces.html#segments"><i class="fa fa-check"></i><b>3.2.2</b> Segments</a></li>
<li class="chapter" data-level="3.2.3" data-path="scatter-traces.html"><a href="scatter-traces.html#density-plots"><i class="fa fa-check"></i><b>3.2.3</b> Density plots</a></li>
<li class="chapter" data-level="3.2.4" data-path="scatter-traces.html"><a href="scatter-traces.html#parallel-coordinates"><i class="fa fa-check"></i><b>3.2.4</b> Parallel Coordinates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="scatter-traces.html"><a href="scatter-traces.html#polygons"><i class="fa fa-check"></i><b>3.3</b> Polygons</a><ul>
<li class="chapter" data-level="3.3.1" data-path="scatter-traces.html"><a href="scatter-traces.html#ribbons"><i class="fa fa-check"></i><b>3.3.1</b> Ribbons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>4</b> Maps</a><ul>
<li class="chapter" data-level="4.1" data-path="maps.html"><a href="maps.html#maps-integrated"><i class="fa fa-check"></i><b>4.1</b> Integrated maps</a><ul>
<li class="chapter" data-level="4.1.1" data-path="maps.html"><a href="maps.html#overview-1"><i class="fa fa-check"></i><b>4.1.1</b> Overview</a></li>
<li class="chapter" data-level="4.1.2" data-path="maps.html"><a href="maps.html#choropleths"><i class="fa fa-check"></i><b>4.1.2</b> Choropleths</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="maps.html"><a href="maps.html#maps-custom"><i class="fa fa-check"></i><b>4.2</b> Custom maps</a><ul>
<li class="chapter" data-level="4.2.1" data-path="maps.html"><a href="maps.html#sf"><i class="fa fa-check"></i><b>4.2.1</b> Simple features (sf)</a></li>
<li class="chapter" data-level="4.2.2" data-path="maps.html"><a href="maps.html#cartograms"><i class="fa fa-check"></i><b>4.2.2</b> Cartograms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bars-histograms.html"><a href="bars-histograms.html"><i class="fa fa-check"></i><b>5</b> Bars &amp; histograms</a><ul>
<li class="chapter" data-level="5.1" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-numeric-distributions"><i class="fa fa-check"></i><b>5.1</b> Multiple numeric distributions</a></li>
<li class="chapter" data-level="5.2" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-discrete-distributions"><i class="fa fa-check"></i><b>5.2</b> Multiple discrete distributions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="boxplots.html"><a href="boxplots.html"><i class="fa fa-check"></i><b>6</b> Boxplots</a></li>
<li class="chapter" data-level="7" data-path="frequencies-2D.html"><a href="frequencies-2D.html"><i class="fa fa-check"></i><b>7</b> 2D frequencies</a><ul>
<li class="chapter" data-level="7.1" data-path="frequencies-2D.html"><a href="frequencies-2D.html#rectangular-binning-in-plotly.js"><i class="fa fa-check"></i><b>7.1</b> Rectangular binning in plotly.js</a></li>
<li class="chapter" data-level="7.2" data-path="frequencies-2D.html"><a href="frequencies-2D.html#rectangular-binning-in-r"><i class="fa fa-check"></i><b>7.2</b> Rectangular binning in R</a></li>
<li class="chapter" data-level="7.3" data-path="frequencies-2D.html"><a href="frequencies-2D.html#categorical-axes"><i class="fa fa-check"></i><b>7.3</b> Categorical axes</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="d-charts.html"><a href="d-charts.html"><i class="fa fa-check"></i><b>8</b> 3D charts</a><ul>
<li class="chapter" data-level="8.1" data-path="d-charts.html"><a href="d-charts.html#markers-1"><i class="fa fa-check"></i><b>8.1</b> Markers</a></li>
<li class="chapter" data-level="8.2" data-path="d-charts.html"><a href="d-charts.html#paths"><i class="fa fa-check"></i><b>8.2</b> Paths</a></li>
<li class="chapter" data-level="8.3" data-path="d-charts.html"><a href="d-charts.html#lines-1"><i class="fa fa-check"></i><b>8.3</b> Lines</a></li>
<li class="chapter" data-level="8.4" data-path="d-charts.html"><a href="d-charts.html#axes"><i class="fa fa-check"></i><b>8.4</b> Axes</a></li>
<li class="chapter" data-level="8.5" data-path="d-charts.html"><a href="d-charts.html#surfaces"><i class="fa fa-check"></i><b>8.5</b> Surfaces</a></li>
</ul></li>
<li class="part"><span><b>II Publishing views</b></span></li>
<li class="chapter" data-level="9" data-path="publish.html"><a href="publish.html"><i class="fa fa-check"></i><b>9</b> Introduction</a></li>
<li class="chapter" data-level="10" data-path="saving.html"><a href="saving.html"><i class="fa fa-check"></i><b>10</b> Saving and embedding HTML</a></li>
<li class="chapter" data-level="11" data-path="exporting-static-images.html"><a href="exporting-static-images.html"><i class="fa fa-check"></i><b>11</b> Exporting static images</a><ul>
<li class="chapter" data-level="11.1" data-path="exporting-static-images.html"><a href="exporting-static-images.html#with-code"><i class="fa fa-check"></i><b>11.1</b> With code</a></li>
<li class="chapter" data-level="11.2" data-path="exporting-static-images.html"><a href="exporting-static-images.html#from-a-browser"><i class="fa fa-check"></i><b>11.2</b> From a browser</a></li>
<li class="chapter" data-level="11.3" data-path="exporting-static-images.html"><a href="exporting-static-images.html#sizing-exports"><i class="fa fa-check"></i><b>11.3</b> Sizing exports</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="editing-views.html"><a href="editing-views.html"><i class="fa fa-check"></i><b>12</b> Editing views for publishing</a></li>
<li class="part"><span><b>III Combining multiple views</b></span></li>
<li class="chapter" data-level="13" data-path="arranging-views.html"><a href="arranging-views.html"><i class="fa fa-check"></i><b>13</b> Arranging views</a><ul>
<li class="chapter" data-level="13.1" data-path="arranging-views.html"><a href="arranging-views.html#arranging-plotly-objects"><i class="fa fa-check"></i><b>13.1</b> Arranging plotly objects</a><ul>
<li class="chapter" data-level="13.1.1" data-path="arranging-views.html"><a href="arranging-views.html#recursive-subplots"><i class="fa fa-check"></i><b>13.1.1</b> Recursive subplots</a></li>
<li class="chapter" data-level="13.1.2" data-path="arranging-views.html"><a href="arranging-views.html#other-approaches-applications"><i class="fa fa-check"></i><b>13.1.2</b> Other approaches &amp; applications</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="arranging-views.html"><a href="arranging-views.html#arranging-htmlwidgets"><i class="fa fa-check"></i><b>13.2</b> Arranging htmlwidgets</a><ul>
<li class="chapter" data-level="13.2.1" data-path="arranging-views.html"><a href="arranging-views.html#flexdashboard"><i class="fa fa-check"></i><b>13.2.1</b> Flexdashboard</a></li>
<li class="chapter" data-level="13.2.2" data-path="arranging-views.html"><a href="arranging-views.html#bootstrap-grid-layout"><i class="fa fa-check"></i><b>13.2.2</b> Bootstrap grid layout</a></li>
<li class="chapter" data-level="13.2.3" data-path="arranging-views.html"><a href="arranging-views.html#css-flexbox"><i class="fa fa-check"></i><b>13.2.3</b> CSS flexbox</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="arranging-views.html"><a href="arranging-views.html#navigating-many-views"><i class="fa fa-check"></i><b>13.3</b> Arranging many views</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="animating-views.html"><a href="animating-views.html"><i class="fa fa-check"></i><b>14</b> Animating views</a><ul>
<li class="chapter" data-level="14.1" data-path="animating-views.html"><a href="animating-views.html#animation-api"><i class="fa fa-check"></i><b>14.1</b> Animation API</a></li>
<li class="chapter" data-level="14.2" data-path="animating-views.html"><a href="animating-views.html#animation-support"><i class="fa fa-check"></i><b>14.2</b> Animation support</a></li>
</ul></li>
<li class="part"><span><b>IV Linking multiple views</b></span></li>
<li class="chapter" data-level="15" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>15</b> Introduction</a></li>
<li class="chapter" data-level="16" data-path="client-side-linking.html"><a href="client-side-linking.html"><i class="fa fa-check"></i><b>16</b> Client-side linking</a><ul>
<li class="chapter" data-level="16.1" data-path="client-side-linking.html"><a href="client-side-linking.html#graphical-queries"><i class="fa fa-check"></i><b>16.1</b> Graphical queries</a></li>
<li class="chapter" data-level="16.2" data-path="client-side-linking.html"><a href="client-side-linking.html#filter"><i class="fa fa-check"></i><b>16.2</b> Highlight versus filter events</a></li>
<li class="chapter" data-level="16.3" data-path="client-side-linking.html"><a href="client-side-linking.html#linking-animated-views"><i class="fa fa-check"></i><b>16.3</b> Linking animated views</a></li>
<li class="chapter" data-level="16.4" data-path="client-side-linking.html"><a href="client-side-linking.html#querying-examples"><i class="fa fa-check"></i><b>16.4</b> Examples</a><ul>
<li class="chapter" data-level="16.4.1" data-path="client-side-linking.html"><a href="client-side-linking.html#trellis-linking"><i class="fa fa-check"></i><b>16.4.1</b> Querying facetted charts</a></li>
<li class="chapter" data-level="16.4.2" data-path="client-side-linking.html"><a href="client-side-linking.html#statistical-queries"><i class="fa fa-check"></i><b>16.4.2</b> Statistical queries</a></li>
<li class="chapter" data-level="16.4.3" data-path="client-side-linking.html"><a href="client-side-linking.html#statistical-queries-ggplot"><i class="fa fa-check"></i><b>16.4.3</b> Statistical queries with <code>ggplotly()</code></a></li>
<li class="chapter" data-level="16.4.4" data-path="client-side-linking.html"><a href="client-side-linking.html#geo-spatial-queries"><i class="fa fa-check"></i><b>16.4.4</b> Geo-spatial queries</a></li>
<li class="chapter" data-level="16.4.5" data-path="client-side-linking.html"><a href="client-side-linking.html#linking-with-other-htmlwidgets"><i class="fa fa-check"></i><b>16.4.5</b> Linking with other htmlwidgets</a></li>
<li class="chapter" data-level="16.4.6" data-path="client-side-linking.html"><a href="client-side-linking.html#ggally-ggpairs"><i class="fa fa-check"></i><b>16.4.6</b> Generalized pairs plots</a></li>
<li class="chapter" data-level="16.4.7" data-path="client-side-linking.html"><a href="client-side-linking.html#ggally-ggnostic"><i class="fa fa-check"></i><b>16.4.7</b> Querying diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="client-side-linking.html"><a href="client-side-linking.html#limitations"><i class="fa fa-check"></i><b>16.5</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html"><i class="fa fa-check"></i><b>17</b> Server-side linking with shiny</a><ul>
<li class="chapter" data-level="17.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#hello-shiny"><i class="fa fa-check"></i><b>17.1</b> Embedding plotly in shiny</a><ul>
<li class="chapter" data-level="17.1.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#your-first-shiny-app"><i class="fa fa-check"></i><b>17.1.1</b> Your first shiny app</a></li>
<li class="chapter" data-level="17.1.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#hiding-and-redrawing-on-resize"><i class="fa fa-check"></i><b>17.1.2</b> Hiding and redrawing on resize</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#shiny-plotly-inputs"><i class="fa fa-check"></i><b>17.2</b> Leveraging plotly input events</a><ul>
<li class="chapter" data-level="17.2.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#dragging-events"><i class="fa fa-check"></i><b>17.2.1</b> Dragging events</a></li>
<li class="chapter" data-level="17.2.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#d-events"><i class="fa fa-check"></i><b>17.2.2</b> 3D events</a></li>
<li class="chapter" data-level="17.2.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#edit-events"><i class="fa fa-check"></i><b>17.2.3</b> Edit events</a></li>
<li class="chapter" data-level="17.2.4" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#relayout-vs-restyle-events"><i class="fa fa-check"></i><b>17.2.4</b> Relayout vs restyle events</a></li>
<li class="chapter" data-level="17.2.5" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#scoping-events"><i class="fa fa-check"></i><b>17.2.5</b> Scoping events</a></li>
<li class="chapter" data-level="17.2.6" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#event-priority"><i class="fa fa-check"></i><b>17.2.6</b> Event priority</a></li>
<li class="chapter" data-level="17.2.7" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#handling-discrete-axes"><i class="fa fa-check"></i><b>17.2.7</b> Handling discrete axes</a></li>
<li class="chapter" data-level="17.2.8" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#reactive-vals"><i class="fa fa-check"></i><b>17.2.8</b> Accumulating and managing event data</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#shiny-performance"><i class="fa fa-check"></i><b>17.3</b> Improving performance</a><ul>
<li class="chapter" data-level="17.3.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#proxies"><i class="fa fa-check"></i><b>17.3.1</b> Partial plotly updates</a></li>
<li class="chapter" data-level="17.3.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#partial-update-examples"><i class="fa fa-check"></i><b>17.3.2</b> Partial update examples</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#advanced-applications"><i class="fa fa-check"></i><b>17.4</b> Advanced applications</a><ul>
<li class="chapter" data-level="17.4.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#drill-down"><i class="fa fa-check"></i><b>17.4.1</b> Drill-down</a></li>
<li class="chapter" data-level="17.4.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#crossfilter"><i class="fa fa-check"></i><b>17.4.2</b> Cross-filter</a></li>
<li class="chapter" data-level="17.4.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#drag-brush"><i class="fa fa-check"></i><b>17.4.3</b> A draggable brush</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#discussion"><i class="fa fa-check"></i><b>17.5</b> Discussion</a></li>
</ul></li>
<li class="part"><span><b>V Custom behavior with JavaScript</b></span></li>
<li class="chapter" data-level="18" data-path="javascript.html"><a href="javascript.html"><i class="fa fa-check"></i><b>18</b> Introduction</a></li>
<li class="chapter" data-level="19" data-path="json.html"><a href="json.html"><i class="fa fa-check"></i><b>19</b> Working with JSON</a><ul>
<li class="chapter" data-level="19.1" data-path="json.html"><a href="json.html#assignment-subsetting-and-iteration"><i class="fa fa-check"></i><b>19.1</b> Assignment, subsetting, and iteration</a></li>
<li class="chapter" data-level="19.2" data-path="json.html"><a href="json.html#mapping-r-to-json"><i class="fa fa-check"></i><b>19.2</b> Mapping R to JSON</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="js-event-handlers.html"><a href="js-event-handlers.html"><i class="fa fa-check"></i><b>20</b> Adding custom event handlers</a></li>
<li class="chapter" data-level="21" data-path="supplying-custom-data.html"><a href="supplying-custom-data.html"><i class="fa fa-check"></i><b>21</b> Supplying custom data</a></li>
<li class="chapter" data-level="22" data-path="client-side.html"><a href="client-side.html"><i class="fa fa-check"></i><b>22</b> Leveraging web technologies from R</a><ul>
<li class="chapter" data-level="22.1" data-path="client-side.html"><a href="client-side.html#web-infrastructure"><i class="fa fa-check"></i><b>22.1</b> Web infrastructure</a></li>
<li class="chapter" data-level="22.2" data-path="client-side.html"><a href="client-side.html#react"><i class="fa fa-check"></i><b>22.2</b> Modern JS &amp; React</a></li>
</ul></li>
<li class="part"><span><b>VI Various special topics</b></span></li>
<li class="chapter" data-level="23" data-path="is-plotly-free-secure.html"><a href="is-plotly-free-secure.html"><i class="fa fa-check"></i><b>23</b> Is plotly free &amp; secure?</a></li>
<li class="chapter" data-level="24" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>24</b> Improving performance</a></li>
<li class="chapter" data-level="25" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html"><i class="fa fa-check"></i><b>25</b> Controlling tooltips</a><ul>
<li class="chapter" data-level="25.1" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#tooltip-text"><i class="fa fa-check"></i><b>25.1</b> <code>plot_ly()</code> tooltips</a></li>
<li class="chapter" data-level="25.2" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#tooltip-text-ggplotly"><i class="fa fa-check"></i><b>25.2</b> <code>ggplotly()</code> tooltips</a></li>
<li class="chapter" data-level="25.3" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#styling"><i class="fa fa-check"></i><b>25.3</b> Styling</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="control-modebar.html"><a href="control-modebar.html"><i class="fa fa-check"></i><b>26</b> Control the modebar</a><ul>
<li class="chapter" data-level="26.1" data-path="control-modebar.html"><a href="control-modebar.html#remove-the-entire-modebar"><i class="fa fa-check"></i><b>26.1</b> Remove the entire modebar</a></li>
<li class="chapter" data-level="26.2" data-path="control-modebar.html"><a href="control-modebar.html#remove-the-plotly-logo"><i class="fa fa-check"></i><b>26.2</b> Remove the plotly logo</a></li>
<li class="chapter" data-level="26.3" data-path="control-modebar.html"><a href="control-modebar.html#remove-modebar-buttons-by-name"><i class="fa fa-check"></i><b>26.3</b> Remove modebar buttons by name</a></li>
<li class="chapter" data-level="26.4" data-path="control-modebar.html"><a href="control-modebar.html#add-custom-modebar-buttons"><i class="fa fa-check"></i><b>26.4</b> Add custom modebar buttons</a></li>
<li class="chapter" data-level="26.5" data-path="control-modebar.html"><a href="control-modebar.html#control-image-downloads"><i class="fa fa-check"></i><b>26.5</b> Control image downloads</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="working-with-colors.html"><a href="working-with-colors.html"><i class="fa fa-check"></i><b>27</b> Working with colors</a></li>
<li class="chapter" data-level="28" data-path="working-with-symbols.html"><a href="working-with-symbols.html"><i class="fa fa-check"></i><b>28</b> Working with symbols and glyphs</a></li>
<li class="chapter" data-level="29" data-path="embedding-images.html"><a href="embedding-images.html"><i class="fa fa-check"></i><b>29</b> Embedding images</a></li>
<li class="chapter" data-level="30" data-path="locales.html"><a href="locales.html"><i class="fa fa-check"></i><b>30</b> Language support</a></li>
<li class="chapter" data-level="31" data-path="mathjax.html"><a href="mathjax.html"><i class="fa fa-check"></i><b>31</b> LaTeX rendering</a><ul>
<li class="chapter" data-level="31.1" data-path="mathjax.html"><a href="mathjax.html#mathjax-caveats"><i class="fa fa-check"></i><b>31.1</b> MathJax caveats</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="the-data-plot-pipeline.html"><a href="the-data-plot-pipeline.html"><i class="fa fa-check"></i><b>32</b> The data-plot-pipeline</a></li>
<li class="chapter" data-level="33" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html"><i class="fa fa-check"></i><b>33</b> Improving <code>ggplotly()</code></a><ul>
<li class="chapter" data-level="33.1" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html#modifying-layout"><i class="fa fa-check"></i><b>33.1</b> Modifying layout</a></li>
<li class="chapter" data-level="33.2" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html#modifying-data"><i class="fa fa-check"></i><b>33.2</b> Modifying data</a></li>
<li class="chapter" data-level="33.3" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html#leveraging-statistical-output"><i class="fa fa-check"></i><b>33.3</b> Leveraging statistical output</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="custom-geoms.html"><a href="custom-geoms.html"><i class="fa fa-check"></i><b>34</b> Translating custom ggplot2 geoms</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Interactive web-based data visualization with R, plotly, and shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scatter-traces" class="section level1">
<h1><span class="header-section-number">3</span> Scattered foundations</h1>
<p>As we learned in Section <a href="overview.html#intro-plotly-js">2.2</a>, a plotly.js figure contains one (or more) trace(s), and every trace has a type. The trace type scatter is great for drawing low-level geometries (e.g., points, lines, text, and polygons) and provides the foundation for many <code>add_*()</code> functions (e.g., <code>add_markers()</code>, <code>add_lines()</code>, <code>add_paths()</code>, <code>add_segments()</code>, <code>add_ribbons()</code>, <code>add_area()</code>, and <code>add_polygons()</code>) as well as many <code>ggplotly()</code> charts. These scatter-based layers provide a more convenient interface to special cases of the scatter trace by doing a bit of data wrangling and transformation under-the-hood before mapping to scatter trace(s). For a simple example, <code>add_lines()</code> ensures lines are drawn according to the ordering of <code>x</code>, which is desirable for a time series plotting. This behavior is subtly different than <code>add_paths()</code> which uses row ordering instead.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plotly)
<span class="kw">data</span>(economics, <span class="dt">package =</span> <span class="st">&quot;ggplot2&quot;</span>)

<span class="co"># sort economics by psavert, just to </span>
<span class="co"># show difference between paths and lines</span>
p &lt;-<span class="st"> </span>economics <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(psavert) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>date, <span class="dt">y =</span> <span class="op">~</span>psavert)

<span class="kw">add_paths</span>(p)
<span class="kw">add_lines</span>(p)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-intro"></span>
<img src="images/scatter-intro.svg" alt="The difference between add_paths() and add_lines(): the top panel connects observations according to the ordering of psavert (personal savings rate), whereas the bottom panel connects observations according to the ordering of x (the date)." width="100%" />
<p class="caption">
FIGURE 3.1: The difference between <code>add_paths()</code> and <code>add_lines()</code>: the top panel connects observations according to the ordering of <code>psavert</code> (personal savings rate), whereas the bottom panel connects observations according to the ordering of <code>x</code> (the date).
</p>
</div>
<p>Section <a href="overview.html#intro-plotly">2.1</a> introduced â€˜aesthetic mappingâ€™ arguments (unique to the R package) which make it easier to map data to visual properties (e.g., <code>color</code>, <code>linetype</code>, etc). In addition to these arguments, <strong>dplyr</strong> groupings can be used to ensure there is at least one geometry per group. The top panel of Figure <a href="scatter-traces.html#fig:scatter-intro">3.1</a> demonstrates how <code>group_by()</code> could be used to effectively wrap the time series from Figure <a href="scatter-traces.html#fig:scatter-intro">3.1</a> by year, which can be useful for visualizing annual seasonality. Another approach to generating at least one geometry per â€˜groupâ€™ is to provide categorical variable to a relevant aesthetic (e.g., <code>color</code>), as shown in the bottom panel of Figure <a href="scatter-traces.html#fig:scatter-intro">3.1</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lubridate)
econ &lt;-<span class="st"> </span>economics <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">yr =</span> <span class="kw">year</span>(date), <span class="dt">mnth =</span> <span class="kw">month</span>(date))

<span class="co"># one trace (more performant, but less interactive)</span>
econ <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(yr) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>mnth, <span class="dt">y =</span> <span class="op">~</span>uempmed) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">text =</span> <span class="op">~</span>yr)

<span class="co"># multiple traces (less performant, but more interactive)</span>
<span class="kw">plot_ly</span>(econ, <span class="dt">x =</span> <span class="op">~</span>mnth, <span class="dt">y =</span> <span class="op">~</span>uempmed) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">color =</span> <span class="op">~</span><span class="kw">ordered</span>(yr))
  
<span class="co"># the split argument guarantees one trace per group level (regardless of the variable type)</span>
<span class="co"># this is useful if you want a consistent visual properties over multiple traces </span>
<span class="co"># plot_ly(econ, x = ~mnth, y = ~uempmed) %&gt;%</span>
<span class="co">#   add_lines(split = ~yr, color = I(&quot;black&quot;))</span></code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-lines"></span>
<iframe src="https://player.vimeo.com/video/316679591?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 3.2: Drawing multiple lines using <strong>dplyr</strong> groups (top panel) versus a categorical <code>color</code> mapping (bottom panel). Comparatively speaking, the bottom panel has more interactive capabilites (e.g., legend-based filtering and multiple tooltips), but it does not scale as well with many lines.
</p>
</div>
<p>Not only do these plots differ in visual appearance, they also differ in interactive capabilties, computational performance, and underlying implementation. Thatâ€™s because, the grouping approach (top panel of Figure <a href="scatter-traces.html#fig:scatter-lines">3.2</a>) uses just one plotly.js trace (more performant, less interactive), whereas the <code>color</code> approach (bottom panel of Figure <a href="scatter-traces.html#fig:scatter-lines">3.2</a>) generates one trace per line/year. In this case, the benefit of having multiple traces is that we can perform interactive filtering via the legend and compare multiple y-values at a given x. The cost of having those capabilities is that plots starts to be become sluggish after a few hundred traces, whereas thousands of lines can be rendered fairly easily in one trace. See Chapter <a href="performance.html#performance">24</a> for more details on scaling and performance.</p>
<p>These features make it easier to get started using plotly.js, but it still pays off to learn how to use plotly.js directly. You wonâ€™t find plotly.js attributes listed as explicit arguments in any <strong>plotly</strong> function (except for the special <code>type</code> attribute), but they are passed along verbatim to the plotly.js figure definition through the <code>...</code> operator. The scatter-based layers in this chapter fix the <code>type</code> plotly.js attribute to <code>"scatter"</code> as well as the <a href="https://plot.ly/r/reference/#scatter-mode"><code>mode</code></a> (e.g., <code>add_markers()</code> uses <code>mode='markers'</code> etc), but you could also use the lower-level <code>add_trace()</code> to work more directly with plotly.js. For example, Figure <a href="scatter-traces.html#fig:tooltip-praise">3.3</a> shows how to render markers, lines, and text in the same scatter trace. It also demonstrates how to leverage <em>nested</em> plotly.js attributes, like <a href="https://plot.ly/r/reference/#scatter-textfont"><code>textfont</code></a> and <a href="https://plot.ly/r/reference/#layout-xaxis"><code>xaxis</code></a> â€“ these attributes contain other attributes, so you need to supply a suitable named list to these arguments.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">99</span>)
<span class="kw">plot_ly</span>() <span class="op">%&gt;%</span>
<span class="st"> </span><span class="kw">add_trace</span>(
   <span class="dt">type =</span> <span class="st">&quot;scatter&quot;</span>,
   <span class="dt">mode =</span> <span class="st">&quot;markers+lines+text&quot;</span>,
   <span class="dt">x =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">6</span>, 
   <span class="dt">y =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">6</span>,
   <span class="dt">text =</span> <span class="kw">replicate</span>(<span class="dv">3</span>, praise<span class="op">::</span><span class="kw">praise</span>(<span class="st">&quot;You are ${adjective}! ðŸ™Œ&quot;</span>)),
   <span class="dt">textposition =</span> <span class="st">&quot;right&quot;</span>,
   <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>,
   <span class="dt">textfont =</span> <span class="kw">list</span>(<span class="dt">family =</span> <span class="st">&quot;Roboto Condensed&quot;</span>, <span class="dt">size =</span> <span class="dv">16</span>)
 ) <span class="op">%&gt;%</span>
<span class="st"> </span><span class="kw">layout</span>(<span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">8</span>)))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:tooltip-praise"></span>
<img src="images/tooltip-praise.png" alt="Using the generic add_trace() function to render markers, lines, and text in a single scatter trace. This add_trace() function, as well as any add_*() function allows you to directly specify plotly.js attributes." width="100%" />
<p class="caption">
FIGURE 3.3: Using the generic <code>add_trace()</code> function to render markers, lines, and text in a single scatter trace. This <code>add_trace()</code> function, as well as any <code>add_*()</code> function allows you to directly specify plotly.js attributes.
</p>
</div>
<p>If you are new to plotly.js, I recommend taking a bit of time to look through the plotly.js attributes that are available to the scatter trace type and think how you might be able to use them. Most of these attributes work for other trace types as well, so learning an attribute once for a specific plot can pay off in other contexts as well. The online plotly.js figure reference, <a href="https://plot.ly/r/reference/#scatter" class="uri">https://plot.ly/r/reference/#scatter</a>, is a decent place to search and learn about the attributes, but I recommend using the <code>schema()</code> function instead for a few reasons:</p>
<ul>
<li><code>schema()</code> provides a bit more information than the online docs (e.g., value types, default values, acceptable ranges, etc).</li>
<li>The interface makes it a bit easier to traverse and discover new attributes.</li>
<li>You can be absolutely sure it matches the version used in the R package (the online docs might use a different â€“ probably older â€“ version).</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">schema</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:schema"></span>
<img src="images/schema.png" alt="Using schema() function to traverse through the attributes available to a given trace type (e.g., scatter)" width="40%" />
<p class="caption">
FIGURE 3.4: Using <code>schema()</code> function to traverse through the attributes available to a given trace type (e.g., scatter)
</p>
</div>
<p>The sections that follow in this chapter demonstrate various type of data views using scatter-based layers. In attempt to avoid duplication of documentation, a particular emphasis is put on features only currently availble from the R package (e.g.Â the aesthetic mapping arguments).</p>
<div id="markers" class="section level2">
<h2><span class="header-section-number">3.1</span> Markers</h2>
<p>This section details scatter traces with a <code>mode</code> of <code>"markers"</code> (i.e., <code>add_markers()</code>). For simplicity, many of the examples here use <code>add_markers()</code> with a numeric x and y axis, which results in scatterplot â€“ a common way to visualize the association between two quantitative variables. The content that follows is still relevant markers displayed non-numeric x and y (aka dot pots) as shown in Section <a href="scatter-traces.html#dot-plots">3.1.6</a></p>
<div id="marker-alpha" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Alpha blending</h3>
<p>As <span class="citation">Unwin (<a href="#ref-unwin-graphical-analysis" role="doc-biblioref">2015</a>)</span> notes, scatterplots can be useful for exposing other important features including: casual relationships, outliers, clusters, gaps, barriers, and conditional relationships. A common problem with scatterplots however is overplotting, meaning that there are multiple observations occupying the same (or similar) x/y locations. Figure <a href="scatter-traces.html#fig:scatterplots">3.5</a> demonstrates one way to combat overplotting via alpha blending. When dealing with tens of thousands of points (or more), consider using <code>toWebGL()</code> to render plots using Canvas rather than SVG (more in Chapter <a href="performance.html#performance">24</a>, or leveraging 2D density estimation (section <a href="frequencies-2D.html#rectangular-binning-in-r">7.2</a>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subplot</span>(
  <span class="kw">plot_ly</span>(mpg, <span class="dt">x =</span> <span class="op">~</span>cty, <span class="dt">y =</span> <span class="op">~</span>hwy, <span class="dt">name =</span> <span class="st">&quot;default&quot;</span>),
  <span class="kw">plot_ly</span>(mpg, <span class="dt">x =</span> <span class="op">~</span>cty, <span class="dt">y =</span> <span class="op">~</span>hwy) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">add_markers</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">name =</span> <span class="st">&quot;alpha&quot;</span>)
)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatterplots"></span>
<img src="images/scatterplots.svg" alt="Combating overplotting in a scatterplot with alpha blending." width="100%" />
<p class="caption">
FIGURE 3.5: Combating overplotting in a scatterplot with alpha blending.
</p>
</div>
</div>
<div id="marker-color" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Colors</h3>
<p>As discussed in <a href="overview.html#intro-plotly-js">2.2</a>, mapping a discrete variable to <code>color</code> produces one trace per category, which is desirable for itâ€™s legend and hover properties. On the other hand, mapping a <em>numeric</em> variable to <code>color</code> produces one trace, as well as a <a href="https://plot.ly/r/reference/#scatter-marker-colorbar">colorbar</a> guide for visually decoding colors back to data values. The <code>colorbar()</code> function can be used to customize the appearance of this automatically generated guide. The default colorscale is viridis, a perceptually-uniform colorscale (even when converted to black-and-white), and perceivable even to those with common forms of color blindness <span class="citation">(Data Science <a href="#ref-viridis" role="doc-biblioref">2016</a>)</span>. Viridis is also the default colorscale for ordered factors.</p>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(mpg, <span class="dt">x =</span> <span class="op">~</span>cty, <span class="dt">y =</span> <span class="op">~</span>hwy, <span class="dt">alpha =</span> <span class="fl">0.5</span>)
<span class="kw">subplot</span>(
  <span class="kw">add_markers</span>(p, <span class="dt">color =</span> <span class="op">~</span>cyl, <span class="dt">showlegend =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">colorbar</span>(<span class="dt">title =</span> <span class="st">&quot;Viridis&quot;</span>),
  <span class="kw">add_markers</span>(p, <span class="dt">color =</span> <span class="op">~</span><span class="kw">factor</span>(cyl))
)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:color-types"></span>
<img src="images/color-types.svg" alt="Variations on a numeric color mapping." width="100%" />
<p class="caption">
FIGURE 3.6: Variations on a numeric color mapping.
</p>
</div>
<p>There are numerous ways to alter the default color scale via the <code>colors</code> argument. This argument excepts one of the following: (1) a color brewer palette name (see the row names of <code>RColorBrewer::brewer.pal.info</code> for valid names), (2) a vector of colors to interpolate, or (3) a color interpolation function like <code>colorRamp()</code> or <code>scales::colour_ramp()</code>. Although this grants a lot of flexibility, one should be conscious of using a sequential colorscale for numeric variables (&amp; ordered factors) as shown in <a href="scatter-traces.html#fig:color-numeric">3.7</a>, and a qualitative colorscale for discrete variables as shown in <a href="scatter-traces.html#fig:color-discrete">3.8</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r">col1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#132B43&quot;</span>, <span class="st">&quot;#56B1F7&quot;</span>)
col2 &lt;-<span class="st"> </span>viridisLite<span class="op">::</span><span class="kw">inferno</span>(<span class="dv">10</span>)
col3 &lt;-<span class="st"> </span><span class="kw">colorRamp</span>(<span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;blue&quot;</span>))
<span class="kw">subplot</span>(
  <span class="kw">add_markers</span>(p, <span class="dt">color =</span> <span class="op">~</span>cyl, <span class="dt">colors =</span> col1) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">colorbar</span>(<span class="dt">title =</span> <span class="st">&quot;ggplot2 default&quot;</span>),
  <span class="kw">add_markers</span>(p, <span class="dt">color =</span> <span class="op">~</span>cyl, <span class="dt">colors =</span> col2) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">colorbar</span>(<span class="dt">title =</span> <span class="st">&quot;Inferno&quot;</span>),
  <span class="kw">add_markers</span>(p, <span class="dt">color =</span> <span class="op">~</span>cyl, <span class="dt">colors =</span> col3) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">colorbar</span>(<span class="dt">title =</span> <span class="st">&quot;colorRamp&quot;</span>)
) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">hide_legend</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:color-numeric"></span>
<img src="images/color-numeric.svg" alt="Three variations on a numeric color mapping." width="100%" />
<p class="caption">
FIGURE 3.7: Three variations on a numeric color mapping.
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">col1 &lt;-<span class="st"> &quot;Accent&quot;</span>
col2 &lt;-<span class="st"> </span><span class="kw">colorRamp</span>(<span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))
col3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">`</span><span class="dt">4</span><span class="st">`</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">`</span><span class="dt">5</span><span class="st">`</span> =<span class="st"> &quot;black&quot;</span>, <span class="st">`</span><span class="dt">6</span><span class="st">`</span> =<span class="st"> &quot;blue&quot;</span>, <span class="st">`</span><span class="dt">8</span><span class="st">`</span> =<span class="st"> &quot;green&quot;</span>)
<span class="kw">subplot</span>(
  <span class="kw">add_markers</span>(p, <span class="dt">color =</span> <span class="op">~</span><span class="kw">factor</span>(cyl), <span class="dt">colors =</span> col1),
  <span class="kw">add_markers</span>(p, <span class="dt">color =</span> <span class="op">~</span><span class="kw">factor</span>(cyl), <span class="dt">colors =</span> col2),
  <span class="kw">add_markers</span>(p, <span class="dt">color =</span> <span class="op">~</span><span class="kw">factor</span>(cyl), <span class="dt">colors =</span> col3)
) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">hide_legend</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:color-discrete"></span>
<img src="images/color-discrete.svg" alt="Three variations on a discrete color mapping." width="100%" />
<p class="caption">
FIGURE 3.8: Three variations on a discrete color mapping.
</p>
</div>
<p>As introduced in Figure <a href="overview.html#fig:intro-range">2.3</a>, color codes can be specified manually (i.e., avoid mapping data values to a visual range) by using the <code>I()</code> function. Figure <a href="scatter-traces.html#fig:color-manual">3.9</a> provides a simple example using <code>add_markers()</code>. Any color understood by the <code>col2rgb()</code> function from the <strong>grDevices</strong> package can be used in this way. Chapter <a href="working-with-colors.html#working-with-colors">27</a> provides even more details about working with different color specifications when specifying colors manually.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add_markers</span>(p, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:color-manual"></span>
<img src="images/color-manual.svg" alt="Setting a fixed color directly using I()." width="100%" />
<p class="caption">
FIGURE 3.9: Setting a fixed color directly using <code>I()</code>.
</p>
</div>
<p>The <code>color</code> argument is meant to control the â€˜fill-colorâ€™ of a geometric object, whereas <code>stroke</code> (section <a href="scatter-traces.html#marker-stroke">3.1.4</a>) is meant to control the â€˜outline-colorâ€™ of a geometric object. In the case of <code>add_markers()</code>, than means <code>color</code> maps to the plotly.js attribute <a href="https://plot.ly/r/reference/#scatter-marker-color"><code>marker.color</code></a> and <code>stroke</code> maps to <a href="https://plot.ly/r/reference/#scatter-marker-line-color"><code>marker.line.color</code></a>. Not all, but many, marker symbols have a notion of stroke.</p>
</div>
<div id="marker-symbol" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Symbols</h3>
<p>The <code>symbol</code> argument can be used to map data values to the <code>marker.symbol</code> plotly.js attribute. It uses the same semantics that weâ€™ve already seen for <code>color</code>:</p>
<ul>
<li>A numeric mapping generates trace.</li>
<li>A discrete mapping generates multiple traces (one trace per category).</li>
<li>The plural, <code>symbols</code>, can be used to specify the visual range for the mapping.</li>
<li>Mappings are avoided entirely through <code>I()</code>.</li>
</ul>
<p>For example, the left panel of Figure <a href="scatter-traces.html#fig:symbol-factor">3.10</a> uses a numeric mapping and the right panel uses a discrete mapping. As a result, the left panel is linked to the first legend entry, whereas the right panel is linked to the bottom three legend entries. When plotting multiple traces and no color is specifed, the plotly.js <a href="https://plot.ly/r/reference/#layout-colorway">colorway</a> is applied (i.e., each trace will be rendered a different color). To set a fixed color, you can set the color of every trace generated from this layer with <code>color = I("black")</code>, or similar.</p>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(mpg, <span class="dt">x =</span> <span class="op">~</span>cty, <span class="dt">y =</span> <span class="op">~</span>hwy, <span class="dt">alpha =</span> <span class="fl">0.3</span>) 
<span class="kw">subplot</span>(
  <span class="kw">add_markers</span>(p, <span class="dt">symbol =</span> <span class="op">~</span>cyl, <span class="dt">name =</span> <span class="st">&quot;A single trace&quot;</span>),
  <span class="kw">add_markers</span>(p, <span class="dt">symbol =</span> <span class="op">~</span><span class="kw">factor</span>(cyl), <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>))
)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:symbol-factor"></span>
<img src="images/symbol-factor.svg" alt="Mapping symbol to a numeric variable (left panel) and a factor (right panel)." width="100%" />
<p class="caption">
FIGURE 3.10: Mapping symbol to a numeric variable (left panel) and a factor (right panel).
</p>
</div>
<p>There are two ways to specify the visual range of <code>symbols</code>: (1) numeric codes (interpreted as a <code>pch</code> codes) or (2) a character string specifying a valid <code>marker.symbol</code> value. Figure <a href="scatter-traces.html#fig:symbol-factor-range">3.11</a> uses pch codes (left panel) as well as their corresponding <code>marker.symbol</code> name (right panel) to specify the visual range.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subplot</span>(
  <span class="kw">add_markers</span>(p, <span class="dt">symbol =</span> <span class="op">~</span>cyl, <span class="dt">symbols =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>)),
  <span class="kw">add_markers</span>(
    p, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>),
    <span class="dt">symbol =</span> <span class="op">~</span><span class="kw">factor</span>(cyl), <span class="dt">symbols =</span> <span class="kw">c</span>(<span class="st">&quot;triangle-up&quot;</span>, <span class="st">&quot;diamond&quot;</span>, <span class="st">&quot;circle&quot;</span>)
  )
)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:symbol-factor-range"></span>
<img src="images/symbol-factor-range.svg" alt="Specifying the visual range of symbols." width="100%" />
<p class="caption">
FIGURE 3.11: Specifying the visual range of <code>symbols</code>.
</p>
</div>
<p>These <code>symbols</code> (i.e., the visual range) can also be supplied directly to <code>symbol</code> through <code>I()</code>. For example, Figure <a href="scatter-traces.html#fig:symbol-factor-manual">3.12</a> fixes the marker symbol to a diamond shape.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot_ly</span>(mpg, <span class="dt">x =</span> <span class="op">~</span>cty, <span class="dt">y =</span> <span class="op">~</span>hwy) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(<span class="dt">symbol =</span> <span class="kw">I</span>(<span class="dv">18</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:symbol-factor-manual"></span>
<img src="images/symbol-factor-manual.svg" alt="Setting a fixed symbol directly using I()." width="100%" />
<p class="caption">
FIGURE 3.12: Setting a fixed symbol directly using <code>I()</code>.
</p>
</div>
<p>If youâ€™d like to see all the symbols available to <strong>plotly</strong>, as well as a method for supplying your own custom glyphs, see Chapter <a href="working-with-symbols.html#working-with-symbols">28</a>.</p>
</div>
<div id="marker-stroke" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Stroke and span</h3>
<p>The <code>stroke</code> argument follows the same semantics as <code>color</code> and <code>symbol</code> when it comes to variable mappings and specifying visual ranges. Typically you donâ€™t want to map data values to <code>stroke</code>, you just want to specify a fixed outline color. For example, Figure <a href="scatter-traces.html#fig:stroke-manual">3.13</a> modifies Figure <a href="scatter-traces.html#fig:symbol-factor-manual">3.12</a> to simply add a black outline. By default, the <code>span</code>, or width of the stroke, is zero, youâ€™ll likely want to set the width to be around one pixel.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot_ly</span>(mpg, <span class="dt">x =</span> <span class="op">~</span>cty, <span class="dt">y =</span> <span class="op">~</span>hwy) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(<span class="dt">symbol =</span> <span class="kw">I</span>(<span class="dv">18</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">stroke =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">1</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:stroke-manual"></span>
<img src="images/symbol-factor-range.svg" alt="Using stroke and span to control the outline color as well as the width of that outline." width="100%" />
<p class="caption">
FIGURE 3.13: Using <code>stroke</code> and <code>span</code> to control the outline color as well as the width of that outline.
</p>
</div>
</div>
<div id="marker-size" class="section level3">
<h3><span class="header-section-number">3.1.5</span> Size</h3>
<p>For scatterplots, the <code>size</code> argument controls the area of markers (unless otherwise specified via <a href="https://plot.ly/r/reference/#scatter-marker-sizemode">sizemode</a>), and <em>must</em> be a numeric variable. The <code>sizes</code> argument controls the minimum and maximum size of circles, in pixels:</p>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(mpg, <span class="dt">x =</span> <span class="op">~</span>cty, <span class="dt">y =</span> <span class="op">~</span>hwy, <span class="dt">alpha =</span> <span class="fl">0.3</span>) 
<span class="kw">subplot</span>(
  <span class="kw">add_markers</span>(p, <span class="dt">size =</span> <span class="op">~</span>cyl, <span class="dt">name =</span> <span class="st">&quot;default&quot;</span>),
  <span class="kw">add_markers</span>(p, <span class="dt">size =</span> <span class="op">~</span>cyl, <span class="dt">sizes =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">500</span>), <span class="dt">name =</span> <span class="st">&quot;custom&quot;</span>)
)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:sizes"></span>
<img src="images/sizes.svg" alt="Controlling the size range via sizes (measured in pixels)." width="100%" />
<p class="caption">
FIGURE 3.14: Controlling the size range via <code>sizes</code> (measured in pixels).
</p>
</div>
<p>Similar to other arguments, <code>I()</code> can be used to specify the size directly. In the case of markers, <code>size</code> controls the <a href="https://plot.ly/r/reference/#scatter-marker-size"><code>marker.size</code></a> plotly.js attribute. Remember, you always have the option to set this attribute directly by doing something similar to Figure <a href="scatter-traces.html#fig:sizes-manual">3.15</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot_ly</span>(mpg, <span class="dt">x =</span> <span class="op">~</span>cty, <span class="dt">y =</span> <span class="op">~</span>hwy, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">marker =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">10</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:sizes-manual"></span>
<img src="images/sizes-manual.svg" alt="Setting a fixed marker size directly using marker.size." width="100%" />
<p class="caption">
FIGURE 3.15: Setting a fixed marker size directly using <code>marker.size</code>.
</p>
</div>
</div>
<div id="dot-plots" class="section level3">
<h3><span class="header-section-number">3.1.6</span> Dotplots &amp; error bars</h3>
<p>A dotplot is similar to a scatterplot, except instead of two numeric axes, one is categorical. The usual goal of a dotplot is to compare value(s) on a numerical scale over numerous categories. In this context, dotplots are preferable to pie charts since comparing position along a common scale is much easier than comparing angle or area <span class="citation">(Cleveland and McGill <a href="#ref-graphical-perception" role="doc-biblioref">1984</a>)</span>; <span class="citation">(Bostock <a href="#ref-crowdsourcing-graphical-perception" role="doc-biblioref">2010</a>)</span>. Furthermore, dotplots can be preferable to bar charts, especially when comparing values within a narrow range far away from 0 <span class="citation">(Few <a href="#ref-few-values" role="doc-biblioref">2006</a>)</span>. Also, when presenting point estimates, and uncertainty associated with those estimates, bar charts tend to exaggerate the difference in point estimates, and lose focus on uncertainty <span class="citation">(Messing <a href="#ref-messing" role="doc-biblioref">2012</a>)</span>.</p>
<p>A popular application for dotplots (with error bars) is the so-called â€œcoefficient plotâ€ for visualizing the point estimates of coefficients and their standard error. The <code>coefplot()</code> function in the <strong>coefplot</strong> package <span class="citation">(Lander <a href="#ref-coefplot" role="doc-biblioref">2016</a>)</span> and the <code>ggcoef()</code> function in the <strong>GGally</strong> both produce coefficient plots for many types of model objects in R using <strong>ggplot2</strong>, which we can translate to plotly via <code>ggplotly()</code>. Since these packages use points and segments to draw the coefficient plots, the hover information is not the best, and itâ€™d be better to use <a href="https://plot.ly/r/reference/#scatter-error_x">error objects</a>. Figure <a href="scatter-traces.html#fig:coefplot">3.16</a> uses the <code>tidy()</code> function from the <strong>broom</strong> package <span class="citation">(Robinson <a href="#ref-broom" role="doc-biblioref">2016</a>)</span> to obtain a data frame with one row per model coefficient, and produce a coefficient plot with error bars along the x-axis.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)
<span class="kw">library</span>(forcats)

<span class="co"># Fit a full-factorial linear model</span>
m &lt;-<span class="st"> </span><span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Sepal.Width <span class="op">*</span><span class="st"> </span>Petal.Length <span class="op">*</span><span class="st"> </span>Petal.Width, <span class="dt">data =</span> iris)

<span class="co"># (1) get a tidy() data structure of covariate-level info (e.g., point estimate, standard error, etc)</span>
<span class="co"># (2) make sure term column is a factor ordered by the estimate</span>
<span class="co"># (3) plot estimate by term with an error bar for the standard error</span>
<span class="kw">tidy</span>(m) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">fct_reorder</span>(term, estimate)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>estimate, <span class="dt">y =</span> <span class="op">~</span>term) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(
    <span class="dt">error_x =</span> <span class="op">~</span><span class="kw">list</span>(<span class="dt">value =</span> std.error), 
    <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>),
    <span class="dt">hoverinfo =</span> <span class="st">&quot;x&quot;</span>
  )</code></pre>
<div class="figure" style="text-align: center"><span id="fig:coefplot"></span>
<img src="images/coefplot.png" alt="A coefficient plot." width="100%" />
<p class="caption">
FIGURE 3.16: A coefficient plot.
</p>
</div>
</div>
</div>
<div id="lines" class="section level2">
<h2><span class="header-section-number">3.2</span> Lines</h2>
<p>Many of the same principles we learned about aesthetic mappings with respect to markers (Section <a href="scatter-traces.html#markers">3.1</a>) also apply to lines.<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a> Moreover, at the start of this chapter (namely Figure <a href="scatter-traces.html#fig:scatter-lines">3.2</a>) we also learned how to use <strong>dplyr</strong>â€™s <code>group_by()</code> to ensure there is at least one geometry (in this case, line) per group. We also learned the difference between <code>add_paths()</code> and <code>add_lines()</code> â€“ the former draws lines according to row ordering whereas the latter draw them according to <code>x</code>. In this chapter, weâ€™ll learn about <code>linetype</code>/<code>linetype</code>, an aesthetic that applies to lines and polygons. Weâ€™ll also discuss some other important chart types that can be implemented with <code>add_paths()</code>, <code>add_lines()</code>, and <code>add_segments()</code>.</p>
<div id="linetypes" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Linetypes</h3>
<p>Generally speaking, itâ€™s hard to perceive more than 8 different colors/linetypes/symbols in a given plot, so sometimes we have to filter data to use these effectively. Here we use the <strong>dplyr</strong> package to find the top 5 cities in terms of average monthly sales (<code>top5</code>), then effectively filter the original data to contain just these cities via <code>semi_join()</code>. As Figure <a href="scatter-traces.html#fig:linetypes">3.17</a> demonstrates, once we have the data filtered, mapping city to <code>color</code> or <code>linetype</code> is trivial. The color palette can be altered via the <code>colors</code> argument, and follows the same rules as <a href="#scatterplots">scatterplots</a>. The linetype palette can be altered via the <code>linetypes</code> argument, and accepts Râ€™s <a href="https://github.com/wch/r-source/blob/e5b21d0397c607883ff25cca379687b86933d730/src/library/graphics/man/par.Rd#L726-L743"><code>lty</code> values</a> or plotly.js <a href="https://plot.ly/r/reference/#scatter-line-dash">dash values</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
top5 &lt;-<span class="st"> </span>txhousing <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(city) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">m =</span> <span class="kw">mean</span>(sales, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(m)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">top_n</span>(<span class="dv">5</span>)

tx5 &lt;-<span class="st"> </span><span class="kw">semi_join</span>(txhousing, top5, <span class="dt">by =</span> <span class="st">&quot;city&quot;</span>)

<span class="kw">plot_ly</span>(tx5, <span class="dt">x =</span> <span class="op">~</span>date, <span class="dt">y =</span> <span class="op">~</span>median) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">linetype =</span> <span class="op">~</span>city)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:linetypes"></span>
<img src="images/linetypes.svg" alt="Using color and/or linetype to differentiate groups of lines." width="100%" />
<p class="caption">
FIGURE 3.17: Using <code>color</code> and/or <code>linetype</code> to differentiate groups of lines.
</p>
</div>
<p>If youâ€™d like to control exactly which linetype is used to encode a particular data value, you can provide a named character vector, like in Figure <a href="scatter-traces.html#fig:linetypes-manual">3.18</a>. Note that this is similar to how we provided a discrete colorscale manually for markers in Figure <a href="scatter-traces.html#fig:color-discrete">3.8</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r">ltys &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="dt">Austin =</span> <span class="st">&quot;dashdot&quot;</span>,
  <span class="st">`</span><span class="dt">Collin County</span><span class="st">`</span> =<span class="st"> &quot;longdash&quot;</span>,
  <span class="dt">Dallas =</span> <span class="st">&quot;dash&quot;</span>,
  <span class="dt">Houston =</span> <span class="st">&quot;solid&quot;</span>,
  <span class="st">`</span><span class="dt">San Antonio</span><span class="st">`</span> =<span class="st"> &quot;dot&quot;</span>
)

<span class="kw">plot_ly</span>(tx5, <span class="dt">x =</span> <span class="op">~</span>date, <span class="dt">y =</span> <span class="op">~</span>median) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">linetype =</span> <span class="op">~</span>city, <span class="dt">linetypes =</span> ltys)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:linetypes-manual"></span>
<img src="images/linetypes-manual.svg" alt="Providing a named character vector to linetypes in order to control exactly what linetype gets mapped to which city." width="100%" />
<p class="caption">
FIGURE 3.18: Providing a named character vector to linetypes in order to control exactly what linetype gets mapped to which city.
</p>
</div>
</div>
<div id="segments" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Segments</h3>
<p>The <code>add_segments()</code> function essentially provides a way to connect two points [(<code>x</code>, <code>y</code>) to (<code>xend</code>, <code>yend</code>)] with a line. Segments form the building blocks for numerous useful chart types, including slopegraphs, dumbell charts, candlestick charts, and more. Slopegraphs and dumbell charts are useful for comparing numeric values across numerous categories. Candlestick charts are typically used for visualizing change in a financial asset over time.</p>
<p>Segments can also provide a useful alternative to <code>add_bars()</code> (covered in Section <a href="bars-histograms.html#bars-histograms">5</a>), especially for animations. In particular, Figure <a href="animating-views.html#fig:profile-pyramid">14.5</a> of Section <a href="animating-views.html#animation-support">14.2</a> shows how implement an animated population pyramid using segments instead of bars.</p>
<div id="slopegraph" class="section level4">
<h4><span class="header-section-number">3.2.2.1</span> Slopegraph</h4>
<p>The slope graph, made popular by <span class="citation">Tufte (<a href="#ref-tufte2001" role="doc-biblioref">2001</a><a href="#ref-tufte2001" role="doc-biblioref">b</a>)</span>, is a great way to compare the change in a measurement across numerous groups. This change could be along either a discrete or a continuous axis. For a continuous axis, the slopegraph could be thought of as a decomposition of a line graph into multiple segments. The <strong>slopegraph</strong> R package provides a succinct interface for creating slopegraphs with base or <strong>ggplot2</strong> graphics and also some convenient data sets which weâ€™ll make use of here <span class="citation">(Leeper <a href="#ref-slopegraph" role="doc-biblioref">2017</a>)</span>. Figure <a href="scatter-traces.html#fig:slopegraph">3.19</a> recreates an example from <span class="citation">Tufte (<a href="#ref-tufte2001" role="doc-biblioref">2001</a><a href="#ref-tufte2001" role="doc-biblioref">b</a>)</span>, using the <code>gdp</code> data set from <strong>slopegraph</strong>, and demonstrates a common issue with labelling in slopegraphs â€“ itâ€™s easy to have overlapping labels when anchoring labels on data values. For that reason, this implementation leverages <strong>plotly</strong> ability to interactively edit annotation positions. See Section <a href="editing-views.html#editing-views">12</a> for similar examples of â€˜editing viewsâ€™.</p>
<details>
<p><summary>Click to show code</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(gdp, <span class="dt">package =</span> <span class="st">&quot;slopegraph&quot;</span>)
gdp<span class="op">$</span>Country &lt;-<span class="st"> </span><span class="kw">row.names</span>(gdp)

<span class="kw">plot_ly</span>(gdp) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_segments</span>(
    <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">xend =</span> <span class="dv">2</span>,
    <span class="dt">y =</span> <span class="op">~</span>Year1970, <span class="dt">yend =</span> <span class="op">~</span>Year1979,
    <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray90&quot;</span>)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_annotations</span>(
    <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="op">~</span>Year1970, 
    <span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(Country, <span class="st">&quot;  &quot;</span>, Year1970), 
    <span class="dt">xanchor =</span> <span class="st">&quot;right&quot;</span>, <span class="dt">showarrow =</span> <span class="ot">FALSE</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_annotations</span>(
    <span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="op">~</span>Year1979, 
    <span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(Year1979, <span class="st">&quot;  &quot;</span>, Country),
    <span class="dt">xanchor =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">showarrow =</span> <span class="ot">FALSE</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(
    <span class="dt">title =</span> <span class="st">&quot;Current Receipts of Goverment as a Percentage of Gross Domestic Product&quot;</span>,
    <span class="dt">showlegend =</span> <span class="ot">FALSE</span>,
    <span class="dt">xaxis =</span> <span class="kw">list</span>(
      <span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>),
      <span class="dt">ticktext =</span> <span class="kw">c</span>(<span class="st">&quot;1970&quot;</span>, <span class="st">&quot;1979&quot;</span>),
      <span class="dt">tickvals =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),
      <span class="dt">zeroline =</span> <span class="ot">FALSE</span>
    ),
    <span class="dt">yaxis =</span> <span class="kw">list</span>(
      <span class="dt">title =</span> <span class="st">&quot;&quot;</span>,
      <span class="dt">showgrid =</span> <span class="ot">FALSE</span>,
      <span class="dt">showticks =</span> <span class="ot">FALSE</span>,
      <span class="dt">showticklabels =</span> <span class="ot">FALSE</span>
    )
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">config</span>(<span class="dt">edits =</span> <span class="kw">list</span>(<span class="dt">annotationPosition =</span> <span class="ot">TRUE</span>))</code></pre>
</details>
<div class="figure" style="text-align: center"><span id="fig:slopegraph"></span>
<iframe src="https://player.vimeo.com/video/327585190?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 3.19: Interactively editing the label positioning in a slopegraph.
</p>
</div>
</div>
<div id="dumbell" class="section level4">
<h4><span class="header-section-number">3.2.2.2</span> Dumbell</h4>
<p>So called dumbell charts are similar in concept to slope graphs, but not quite as general. They are typically used to compare two different classes of numeric values across numerous groups. Figure <a href="scatter-traces.html#fig:dumbell">3.20</a> uses the dumbell approach to show average miles per gallon city and highway for different car models. With a dumbell chart, itâ€™s always a good idea to order the categories by a sensible metric â€“ for Figure <a href="scatter-traces.html#fig:dumbell">3.20</a>, the categories are ordered by the city miles per gallon.</p>
<pre class="sourceCode r"><code class="sourceCode r">mpg <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(model) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">c =</span> <span class="kw">mean</span>(cty), <span class="dt">h =</span> <span class="kw">mean</span>(hwy)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> forcats<span class="op">::</span><span class="kw">fct_reorder</span>(model, c)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot_ly</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_segments</span>(
    <span class="dt">x =</span> <span class="op">~</span>c, <span class="dt">y =</span> <span class="op">~</span>model,
    <span class="dt">xend =</span> <span class="op">~</span>h, <span class="dt">yend =</span> <span class="op">~</span>model, 
    <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray&quot;</span>), <span class="dt">showlegend =</span> <span class="ot">FALSE</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(
    <span class="dt">x =</span> <span class="op">~</span>c, <span class="dt">y =</span> <span class="op">~</span>model, 
    <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;blue&quot;</span>), 
    <span class="dt">name =</span> <span class="st">&quot;mpg city&quot;</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(
    <span class="dt">x =</span> <span class="op">~</span>h, <span class="dt">y =</span> <span class="op">~</span>model, 
    <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;red&quot;</span>),
    <span class="dt">name  =</span> <span class="st">&quot;mpg highway&quot;</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;Miles per gallon&quot;</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:dumbell"></span>
<img src="images/dumbell.svg" alt="A dumbell chart of mile per gallon city vs highway by model of car." width="100%" />
<p class="caption">
FIGURE 3.20: A dumbell chart of mile per gallon city vs highway by model of car.
</p>
</div>
</div>
<div id="candlestick" class="section level4">
<h4><span class="header-section-number">3.2.2.3</span> Candlestick</h4>
<p>Figure <a href="scatter-traces.html#fig:candlestick">3.21</a> uses the <strong>quantmod</strong> package <span class="citation">(Ryan <a href="#ref-quantmod" role="doc-biblioref">2016</a>)</span> to obtain stock price data for Microsoft and plots two segments for each day: one to encode the opening/closing values, and one to encode the daily high/low.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(quantmod)
msft &lt;-<span class="st"> </span><span class="kw">getSymbols</span>(<span class="st">&quot;MSFT&quot;</span>, <span class="dt">auto.assign =</span> F)
dat &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(msft)
dat<span class="op">$</span>date &lt;-<span class="st"> </span><span class="kw">index</span>(msft)
dat &lt;-<span class="st"> </span><span class="kw">subset</span>(dat, date <span class="op">&gt;=</span><span class="st"> &quot;2016-01-01&quot;</span>)

<span class="kw">names</span>(dat) &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;^MSFT</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">names</span>(dat))

<span class="kw">plot_ly</span>(dat, <span class="dt">x =</span> <span class="op">~</span>date, <span class="dt">xend =</span> <span class="op">~</span>date, <span class="dt">color =</span> <span class="op">~</span>Close <span class="op">&gt;</span><span class="st"> </span>Open, 
        <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;forestgreen&quot;</span>), <span class="dt">hoverinfo =</span> <span class="st">&quot;none&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_segments</span>(<span class="dt">y =</span> <span class="op">~</span>Low, <span class="dt">yend =</span> <span class="op">~</span>High, <span class="dt">size =</span> <span class="kw">I</span>(<span class="dv">1</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_segments</span>(<span class="dt">y =</span> <span class="op">~</span>Open, <span class="dt">yend =</span> <span class="op">~</span>Close, <span class="dt">size =</span> <span class="kw">I</span>(<span class="dv">3</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">showlegend =</span> <span class="ot">FALSE</span>, <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;Price&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rangeslider</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:candlestick"></span>
<img src="images/candlestick.svg" alt="A candlestick chart built out of segments" width="100%" />
<p class="caption">
FIGURE 3.21: A candlestick chart built out of segments
</p>
</div>
</div>
</div>
<div id="density-plots" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Density plots</h3>
<p>In Section <a href="bars-histograms.html#bars-histograms">5</a>, we leverage a number of algorithms in R for computing the â€œoptimalâ€ number of bins for a histogram, via <code>hist()</code>, and routing those results to <code>add_bars()</code>. We can leverage the <code>density()</code> function for computing kernel density estimates in a similar way, and route the results to <code>add_lines()</code>, as is done in <a href="scatter-traces.html#fig:densities">3.22</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r">kerns &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gaussian&quot;</span>, <span class="st">&quot;epanechnikov&quot;</span>, <span class="st">&quot;rectangular&quot;</span>, 
          <span class="st">&quot;triangular&quot;</span>, <span class="st">&quot;biweight&quot;</span>, <span class="st">&quot;cosine&quot;</span>, <span class="st">&quot;optcosine&quot;</span>)
p &lt;-<span class="st"> </span><span class="kw">plot_ly</span>()
<span class="cf">for</span> (k <span class="cf">in</span> kerns) {
  d &lt;-<span class="st"> </span><span class="kw">density</span>(economics<span class="op">$</span>pce, <span class="dt">kernel =</span> k, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
  p &lt;-<span class="st"> </span><span class="kw">add_lines</span>(p, <span class="dt">x =</span> d<span class="op">$</span>x, <span class="dt">y =</span> d<span class="op">$</span>y, <span class="dt">name =</span> k)
}
p</code></pre>
<div class="figure" style="text-align: center"><span id="fig:densities"></span>
<img src="images/densities.svg" alt="Various kernel density estimates." width="100%" />
<p class="caption">
FIGURE 3.22: Various kernel density estimates.
</p>
</div>
</div>
<div id="parallel-coordinates" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Parallel Coordinates</h3>
<p>One very useful, but often overlooked, visualization technique is the parallel coordinates plot. Parallel coordinates provide a way to compare values along a common (or non-aligned) positional scale(s) â€“ the most basic of all perceptual tasks â€“ in more than 3 dimensions <span class="citation">(Cleveland and McGill <a href="#ref-graphical-perception" role="doc-biblioref">1984</a>)</span>. Usually each line represents every measurement for a given row (or observation) in a data set. Itâ€™s true that plotly.js provides a trace type, parcoords, specifically for parallel coordinates, but</p>
<p>When measurements are on very different scales, some care must be taken, and variables must transformed to be put on a common scale. As Figure <a href="scatter-traces.html#fig:pcp-common">3.23</a> shows, even when variables are measured on a similar scale, it can still be informative to transform variables in different ways.</p>
<pre class="sourceCode r"><code class="sourceCode r">iris<span class="op">$</span>obs &lt;-<span class="st"> </span><span class="kw">seq_len</span>(<span class="kw">nrow</span>(iris))
iris_pcp &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">transform =</span> identity) {
  iris[] &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map_if</span>(iris, is.numeric, transform)
  tidyr<span class="op">::</span><span class="kw">gather</span>(iris, variable, value, <span class="op">-</span>Species, <span class="op">-</span>obs) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(obs) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>variable, <span class="dt">y =</span> <span class="op">~</span>value, <span class="dt">color =</span> <span class="op">~</span>Species) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">add_lines</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>)
}
<span class="kw">subplot</span>(
  <span class="kw">iris_pcp</span>(), 
  <span class="kw">iris_pcp</span>(scale),
  <span class="kw">iris_pcp</span>(scales<span class="op">::</span>rescale),
  <span class="dt">nrows =</span> <span class="dv">3</span>, <span class="dt">shareX =</span> <span class="ot">TRUE</span>
) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">hide_legend</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:pcp-common"></span>
<img src="images/pcp-common.svg" alt="Parallel coordinates plots of the Iris dataset. The top panel shows all variables on a common scale. The middle panel scales each variable to have mean of 0 and standard deviation of 1. In the bottom panel, each variable is scaled to have a minimum of 0 and a maximum of 1." width="100%" />
<p class="caption">
FIGURE 3.23: Parallel coordinates plots of the Iris dataset. The top panel shows all variables on a common scale. The middle panel scales each variable to have mean of 0 and standard deviation of 1. In the bottom panel, each variable is scaled to have a minimum of 0 and a maximum of 1.
</p>
</div>
<p>It is also worth noting that the <strong>GGally</strong> offers a <code>ggparcoord()</code> function which creates parallel coordinate plots via <strong>ggplot2</strong>, which we can convert to plotly via <code>ggplotly()</code>. Thanks to the <a href="#linking-views-without-shiny">linked highlighting</a> framework, parallel coordinates created in this way could be linked to lower dimensional (but sometimes higher resolution) graphics of related data to guide multi-variate data exploration. The <strong>pedestrians</strong> package provides some examples of linking parallel coordinates to other views such as a grand tour for exposing unusual features in a high-dimensional space <span class="citation">(Sievert <a href="#ref-pedestrians" role="doc-biblioref">2019</a><a href="#ref-pedestrians" role="doc-biblioref">a</a>)</span>.</p>
</div>
</div>
<div id="polygons" class="section level2">
<h2><span class="header-section-number">3.3</span> Polygons</h2>
<p>The <code>add_polygons()</code> function is essentially equivalent to <code>add_paths()</code> with the <a href="https://plot.ly/r/reference/#scatter-fill">fill</a> attribute set to â€œtoselfâ€. Polygons form the basis for other, higher-level scatter-based layers (e.g., <code>add_ribbons()</code> and <code>add_sf()</code>) that donâ€™t have a dedicated plotly.js trace type. Polygons can be use to draw many things, but perhaps the most familiar application where you <em>might</em> want to use <code>add_polygons()</code> is to draw geo-spatial objects. If and when you use <code>add_polygons()</code> to draw a map, make sure you fix the aspect ratio (e.g.Â <a href="https://plot.ly/r/reference/#layout-xaxis-scaleanchor"><code>xaxis.scaleanchor</code></a>). On the other hand, Section <a href="maps.html#maps-custom">4.2</a> shows you how to make a custom maps using the <strong>sf</strong> package and <code>add_sf()</code>, which is a bit a work to get started, but is absolutely worth the investment.</p>
<pre class="sourceCode r"><code class="sourceCode r">base &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;world&quot;</span>, <span class="st">&quot;canada&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(group) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plotly_empty</span>(<span class="dt">x =</span> <span class="op">~</span>long, <span class="dt">y =</span> <span class="op">~</span>lat, <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">showlegend =</span> <span class="ot">FALSE</span>, <span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">scaleanchor =</span> <span class="st">&quot;y&quot;</span>))
  
base <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_polygons</span>(<span class="dt">hoverinfo =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(<span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(name, <span class="st">&quot;&lt;br /&gt;&quot;</span>, pop), <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>, 
              <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;red&quot;</span>), <span class="dt">data =</span> maps<span class="op">::</span>canada.cities)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:map-canada"></span>
<img src="images/map-canada.png" alt="Using add_polygons() to make a map of Canada and major Canadian cities via data provided by the maps package (Richard A. Becker, Ray Brownrigg. Enhancements by Thomas P Minka, and Deckmyn. 2018)." width="100%" />
<p class="caption">
FIGURE 3.24: Using <code>add_polygons()</code> to make a map of Canada and major Canadian cities via data provided by the <strong>maps</strong> package <span class="citation">(Richard A. Becker, Ray Brownrigg. Enhancements by Thomas P Minka, and Deckmyn. <a href="#ref-maps" role="doc-biblioref">2018</a>)</span>.
</p>
</div>
<p>As discussion surrounding Figure <a href="maps.html#fig:split-color">4.9</a> points out, scatter-based polygon layers (i.e., <code>add_polygons()</code>, <code>add_ribbons()</code>, etc) render all the polygons using one plotly.js trace by default. This approach is computationally efficient, but itâ€™s not always desirable (e.g.Â canâ€™t have multiple fills per trace, interactivity is relatively limited). To work around the limitations, consider using <code>split</code> (or <code>color</code> with a discrete variable) to split the polygon data into multiple traces. Figure <a href="scatter-traces.html#fig:map-canada-split">3.25</a> demonstrates using <code>split</code> which will impose plotly.jsâ€™ colorway to each trace (i.e., subregion) and leverage <code>hoveron</code> to generate one tooltip per sub-region.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add_polygons</span>(base, <span class="dt">split =</span> <span class="op">~</span>subregion, <span class="dt">hoveron =</span> <span class="st">&quot;fills&quot;</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:map-canada-split"></span>
<img src="images/map-canada-split.png" alt="Using split to render polygons with different fills and interactive properties." width="100%" />
<p class="caption">
FIGURE 3.25: Using <code>split</code> to render polygons with different fills and interactive properties.
</p>
</div>
<div id="ribbons" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Ribbons</h3>
<p>Ribbons are useful for showing uncertainty bounds as a function of x. The <code>add_ribbons()</code> function creates ribbons and requires the arguments: <code>x</code>, <code>ymin</code>, and <code>ymax</code>. The <code>augment()</code> function from the <strong>broom</strong> package appends observational-level model components (e.g., fitted values stored as a new column <code>.fitted</code>) which is useful for extracting those components in a convenient form for visualization. Figure <a href="scatter-traces.html#fig:broom-lm">3.26</a> shows the fitted values and uncertainty bounds from a linear model object.</p>
<pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> mtcars)
broom<span class="op">::</span><span class="kw">augment</span>(m) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>wt, <span class="dt">showlegend =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_markers</span>(<span class="dt">y =</span> <span class="op">~</span>mpg, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_ribbons</span>(<span class="dt">ymin =</span> <span class="op">~</span>.fitted <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>.se.fit, 
              <span class="dt">ymax =</span> <span class="op">~</span>.fitted <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>.se.fit, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray80&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">y =</span> <span class="op">~</span>.fitted, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;steelblue&quot;</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:broom-lm"></span>
<img src="images/broom-lm.svg" alt="Plotting fitted values and uncertainty bounds of a linear model via the broom package." width="100%" />
<p class="caption">
FIGURE 3.26: Plotting fitted values and uncertainty bounds of a linear model via the <strong>broom</strong> package.
</p>
</div>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-unwin-graphical-analysis">
<p>Unwin, Antony. 2015. <em>Graphical Data Analysis with R</em>. CRC Press. <a href="http://www.gradaanwr.net">http://www.gradaanwr.net</a>.</p>
</div>
<div id="ref-viridis">
<p>Data Science, Berkeley Institute for. 2016. â€œMpl Colormaps.â€ 2016. <a href="http://web.archive.org/web/20160601125258/http://bids.github.io/colormap/">http://web.archive.org/web/20160601125258/http://bids.github.io/colormap/</a>.</p>
</div>
<div id="ref-graphical-perception">
<p>Cleveland, William S, and Robert McGill. 1984. â€œGraphical Perception: Theory, Experimentation, and Application to the Development of Graphical Methods.â€ <em>Journal of the American Statistical Association</em> 79 (September): 531â€“54.</p>
</div>
<div id="ref-crowdsourcing-graphical-perception">
<p>Bostock, Jeffrey Heer AND Michael. 2010. â€œCrowdsourcing Graphical Perception: Using Mechanical Turk to Assess Visualization Design.â€ In <em>ACM Human Factors in Computing Systems (Chi)</em>, 203â€“12. <a href="http://vis.stanford.edu/papers/crowdsourcing-graphical-perception">http://vis.stanford.edu/papers/crowdsourcing-graphical-perception</a>.</p>
</div>
<div id="ref-few-values">
<p>Few, Stephen. 2006. â€œData Visualization: Rules for Encoding Values in Graph.â€ 2006. <a href="https://web.archive.org/web/20160404214629/http://www.perceptualedge.com/articles/b-eye/encoding_values_in_graph.pdf">https://web.archive.org/web/20160404214629/http://www.perceptualedge.com/articles/b-eye/encoding_values_in_graph.pdf</a>.</p>
</div>
<div id="ref-messing">
<p>Messing, Solomon. 2012. â€œVisualization Series: Insight from Cleveland and Tufte on Plotting Numeric Data by Groups.â€ 2012. <a href="http://web.archive.org/web/20160602202734/https://solomonmessing.wordpress.com/2012/03/04/visualization-series-insight-from-cleveland-and-tufte-on-plotting-numeric-data-by-groups/">http://web.archive.org/web/20160602202734/https://solomonmessing.wordpress.com/2012/03/04/visualization-series-insight-from-cleveland-and-tufte-on-plotting-numeric-data-by-groups/</a>.</p>
</div>
<div id="ref-coefplot">
<p>Lander, Jared P. 2016. <em>Coefplot: Plots Coefficients from Fitted Models</em>. <a href="https://CRAN.R-project.org/package=coefplot">https://CRAN.R-project.org/package=coefplot</a>.</p>
</div>
<div id="ref-broom">
<p>Robinson, David. 2016. <em>Broom: Convert Statistical Analysis Objects into Tidy Data Frames</em>. <a href="https://CRAN.R-project.org/package=broom">https://CRAN.R-project.org/package=broom</a>.</p>
</div>
<div id="ref-tufte2001">
<p>Tufte, Edward. 2001b. <em>The Visual Display of Quantitative Information</em>. Cheshire, Conn: Graphics Press.</p>
</div>
<div id="ref-slopegraph">
<p>Leeper, Thomas J. 2017. <em>Slopegraph: Edward Tufte-Inspired Slopegraphs</em>.</p>
</div>
<div id="ref-quantmod">
<p>Ryan, Jeffrey A. 2016. <em>Quantmod: Quantitative Financial Modelling Framework</em>. <a href="https://CRAN.R-project.org/package=quantmod">https://CRAN.R-project.org/package=quantmod</a>.</p>
</div>
<div id="ref-pedestrians">
<p>Sievert, Carson. 2019a. <em>Pedestrians: Tools for Exploring Melbourneâ€™s Pedestrian Data</em>. <a href="https://github.com/cpsievert/pedestrians">https://github.com/cpsievert/pedestrians</a>.</p>
</div>
<div id="ref-maps">
<p>Richard A. Becker, Original S code by, Allan R. Wilks. R version by Ray Brownrigg. Enhancements by Thomas P Minka, and Alex Deckmyn. 2018. <em>Maps: Draw Geographical Maps</em>. <a href="https://CRAN.R-project.org/package=maps">https://CRAN.R-project.org/package=maps</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="10">
<li id="fn10"><p>At the time of writing, the plotly.js attributes <a href="https://github.com/plotly/plotly.js/issues/147"><code>line.width</code> and <code>line.color</code></a> do not support multiple values, meaning a single line trace can only have one width/color in 2D line plot, and consequently numeric <code>color</code>/<code>size</code> mappings wonâ€™t work. This isnâ€™t necessarily true for 3D paths/lines and there will likely be support these features for 2D paths/lines in WebGL in the near future.<a href="scatter-traces.html#fnref10" class="footnote-back">â†©</a></p></li>
</ol>
</div>
<script>
  var header = document.querySelector(".book-header");

  var img = document.createElement("img");
  img.src = "images/rstudioCloud.svg";
  img.width = 200;
  img.align = "right";
  img.style = "margin-top:10px; float:right";

  var a = document.createElement("a");
  a.href = "https://rstudio.cloud/project/156701";
  a.target = "_blank";

  a.appendChild(img);
  header.appendChild(a);
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-60116966-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-60116966-3');
</script>
            </section>

          </div>
        </div>
      </div>
<a href="overview.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="maps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cpsievert/plotly_book/edit/master/creating-scatter.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
